<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Symmetry AI - Final</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #ui { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 10px; z-index: 100; }
        button { padding: 15px 25px; border-radius: 30px; border: 2px solid #fff; background: #000; color: #fff; font-weight: bold; }
    </style>
</head>
<body>
<script>
let capture, faceMesh, face;
let side = 'left';

function preload() {
    faceMesh = ml5.faceMesh({ maxFaces: 1, flipped: false });
}

function setup() {
    createCanvas(windowWidth, windowHeight);
    capture = createCapture({ video: { facingMode: "user" }, audio: false });
    capture.size(640, 480);
    capture.hide();
    faceMesh.detectStart(capture, (results) => { face = results[0]; });
}

function draw() {
    background(0);
    if (!face || !face.keypoints) return;

    // 1. זיהוי נקודת האף המדויקת מה-AI
    let nose = face.keypoints[1]; 
    let nx = nose.x; 
    let ny = nose.y;
    
    let vw = capture.width;
    let vh = capture.height;
    
    // 2. חצי רוחב המסך הפיזי
    let halfW = width / 2;

    if (side === 'left') {
        // צד שמאל: לוקח רק את מה שמשמאל לאף ומותח על חצי מסך
        // (image, dx, dy, dW, dH, sx, sy, sW, sH)
        image(capture, 0, 0, halfW, height, 0, 0, nx, vh);
        
        // צד ימין: משקף את אותו החלק בדיוק
        push();
        translate(width, 0);
        scale(-1, 1);
        image(capture, 0, 0, halfW, height, 0, 0, nx, vh);
        pop();
    } else {
        // צד ימין: לוקח רק את מה שמימין לאף ומותח על חצי מסך
        let sourceWidth = vw - nx;
        image(capture, halfW, 0, halfW, height, nx, 0, sourceWidth, vh);
        
        // צד שמאל: משקף את צד ימין
        push();
        translate(halfW, 0);
        scale(-1, 1);
        image(capture, 0, 0, halfW, height, nx, 0, sourceWidth, vh);
        pop();
    }
    
    // קו הפרדה ויזואלי במרכז (איפה שהאף אמור להיות)
    stroke(0, 255, 0);
    strokeWeight(2);
    line(halfW, 0, halfW, height);
}

function touchStarted() { if (capture) capture.elt.play(); }
</script>

<div id="ui">
    <button onclick="side='left'">שמאל כפול</button>
    <button onclick="side='right'">ימין כפול</button>
</div>
</body>
</html>
