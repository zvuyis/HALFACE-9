<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Symmetry AI - Pixel Perfect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        #ui { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 10px; z-index: 100; }
        button { padding: 12px 20px; border-radius: 25px; border: 2px solid #00ff00; background: rgba(0,0,0,0.8); color: #00ff00; font-weight: bold; }
    </style>
</head>
<body>
<script>
let capture, faceMesh, face;
let side = 'left';

function preload() {
    faceMesh = ml5.faceMesh({ maxFaces: 1, flipped: false });
}

function setup() {
    createCanvas(windowWidth, windowHeight);
    capture = createCapture({ video: { facingMode: "user" }, audio: false });
    capture.size(640, 480);
    capture.hide();
    faceMesh.detectStart(capture, (results) => { face = results[0]; });
}

function draw() {
    background(0);
    if (!face) return;

    // 1. זיהוי נקודת האף (ציר הסימטריה הדינמי)
    let nose = face.keypoints[1]; 
    let nx = nose.x; // מיקום האף בוידאו (0-640)
    
    let vw = capture.width;
    let vh = capture.height;
    
    // 2. חישוב יחס מסך (מילוי גובה)
    let s = height / vh;
    let dw = vw * s;
    let dx = (width / 2) - (nx * s); // שומר את האף תמיד במרכז המסך הפיזי

    push();
    if (side === 'left') {
        // --- חצי שמאלי ---
        // מצייר רק את החלק שמשמאל לאף
        image(capture, dx, 0, nx * s, height, 0, 0, nx, vh);
        
        // --- חצי ימני (השיקוף) ---
        push();
        translate(width, 0);
        scale(-1, 1);
        // מצייר שוב את החלק שמשמאל לאף, אבל הפוך
        image(capture, (width/2), 0, nx * s, height, 0, 0, nx, vh);
        pop();
    } else {
        // --- חצי ימני ---
        let rightPartW = vw - nx;
        image(capture, width/2, 0, rightPartW * s, height, nx, 0, rightPartW, vh);
        
        // --- חצי שמאלי (השיקוף) ---
        push();
        translate(width/2, 0);
        scale(-1, 1);
        image(capture, 0, 0, rightPartW * s, height, nx, 0, rightPartW, vh);
        pop();
    }
    
    // קו סימטריה שעוקב אחרי האף
    stroke(0, 255, 0);
    strokeWeight(2);
    line(width/2, 0, width/2, height);
    pop();
}

function touchStarted() { if (capture) capture.elt.play(); }
function windowResized() { resizeCanvas(windowWidth, windowHeight); }
function toggleSide(s) { side = s; }
</script>

<div id="ui">
    <button onclick="side='left'">שכפל שמאל</button>
    <button onclick="side='right'">שכפל ימין</button>
</div>
</body>
</html>
